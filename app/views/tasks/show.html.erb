<% title "#" + @task.id.to_s + " " + @task.name %>

<% content_for :sidebar do %>
  <ul class="actions">
  <li><%= link_to "New Task", new_project_task_path(@project) %></li>
  </ul>

  <% if can? :manage, Task %>
  <h2>Manage</h2>
  <ul>
    <li><%= link_to "Edit Task", edit_project_task_path(@project, @task) %></li>
    <li><%= link_to "Destroy", project_task_path(@project,@task), :confirm => 'Are you sure?', :method => :delete %></li>
  </ul>
  <% end %>
<% end %>

<div class="meta">
  <p>by <%= @task.user.username %> created this on <%= @task.created_at.to_s(:short_date) %>.</p>
  <dl>
    <dt>Status:</dt>
    <dd><%= @task.status %></dd>
    <dt>Priority:</dt>
    <dd><%= @task.priority %></dd>
    <dt>Assigned to:<dt>
    <dd><%= @task.assignee %></dd>
</div>
<div class="content">
  <%= @task.description %>
</div>

<% unless @task.attachment.blank? %>
  <div class="<%= @task.attachment_content_type %>">
    <% if @task.attachment_content_type.include? 'image' %>
      <%= link_to (image_tag @task.attachment_url(:thumb).to_s), @task.attachment_url %>
    <% else %>
      <%= link_to @task.attachment_file_name, @task.attachment_url %> (<%= number_to_human_size(@task.attachment_file_size) %>)
    <% end %>
  </div>
<% end %>

<% unless @task.parent_id.blank? %>
<h3>Parent task:</h3>
<%= render @task.parent %>
<% end %>

<% unless @task.tasks.blank? %>
<h3>Child tasks:</h3>
<%= render @task.tasks %>
<% end %>

<h3>Notes:</h3>
<%= render @notes %>

<div class="notes_new">
  <p><%= current_user.username %></p>
  <%= semantic_form_for @task, :url => project_task_path(@project, @task), :html => { :multipart => true } do |f| %>
    <%= f.inputs :name => "Update task attributes" do %>
        <%= f.input :status, :collection => Task::STATUSES, :include_blank => false %>
        <%= f.input :priority, :collection => Task::PRIORITIES, :include_blank => false %>
        <%= f.input :assigned_user_id, :as => :select, :collection => @project.users, :include_blank => '-- Unassigned --' %>
    <% end %>
    <fieldset class="inputs">
    <ol>      
    <%= fields_for "task[notes_attributes][]", @note do |note| %>
      <li class="text">
        <label>Leave a comment&hellip;</label>
        <%= note.text_area :content, :rows => 6 %>
      </li>
      <li class="file">
        <label>Attach a file</label>
        <%= note.file_field :attachment %>
      </li>
      <%= note.hidden_field :user_id %>
    <% end %>
    </ol>
    </fieldset>
    <%= f.buttons %>
  <% end %>
</div> <!-- comments_new -->